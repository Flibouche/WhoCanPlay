{% extends 'base.html.twig' %}

{% block title %}{{ gameApi[0]["name"] }}{% endblock %}

{% block body %}

<nav class="w-full flex text-sm" aria-label="Breadcrumb">
    <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
        <li class="inline-flex items-center">
            <a href="{{ path('app_home') }}" class="inline-flex items-center text-black dark:text-white hover:text-indigo-800 dark:hover:text-indigo-200">
                <svg class="w-3 h-3 me-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"/>
                </svg>
                Home
            </a>
        </li>
        <li>
            <div class="flex items-center">
                <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                </svg>
                <a href="{{ path('app_game') }}" class="ms-1 md:ms-2 text-black dark:text-white hover:text-indigo-800 dark:hover:text-indigo-200">Games</a>
            </div>
        </li>
        <li aria-current="{{ gameApi[0]['name'] }}">
            <div class="flex items-center">
                <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                </svg>
                <span class="ms-1 md:ms-2 text-black dark:text-white underline">{{ game.slug|replace({'-': ' '})|title }}</span>
            </div>
        </li>
    </ol>
</nav>

<div class="flex flex-col md:flex-row w-full gap-[20px]">

    <section id="primary" class="basis-0 min-w-[70%] max-w-[50rem]">
        <article class="bg-white dark:bg-neutral-800 flex flex-col sm:flex-row mb-5 rounded-xl py-5 text-black dark:text-white shadow-[rgba(50,50,93,0.25)_0px_6px_12px_-2px,_rgba(0,0,0,0.3)_0px_3px_7px_-3px]">
            <header class="mx-5 mb-5 sm:mb-0 shrink-0">
                <figure class="grid justify-center text-center">
                    <img src="https://images.igdb.com/igdb/image/upload/t_cover_big/{{ gameApi[0].cover.image_id }}.jpg"
                        alt="Cover of {{ gameApi[0]['name'] }}" class="rounded-xl">
                </figure>
            </header>

            <div id="game__info" class="flex flex-col pl-5 pr-5 sm:pl-0 relative">
                <h1 class="text-center sm:text-left text-3xl pb-5 sm:pt-5 text-indigo-800 dark:text-indigo-200 font-raleway font-bold">
                    {{ gameApi[0]["name"] }}
                </h1>
                <h2>
                    <strong>Developer</strong> : {% for developer in gameApi[0].involved_companies %}<span>{{
                        developer.company.name }}
                    </span>{% endfor %}
                </h2>
                <h2>
                    <strong>Genres</strong> : {% for genre in gameApi[0].genres %}<span>{{ genre.name }} </span>{%
                    endfor %}
                </h2>
                <h2 class="pb-10">
                    <strong>Platforms</strong> : {% for platform in gameApi[0].platforms %}<span>{{ platform.name }}
                    </span>{% endfor %}
                </h2>
                <h2 class="absolute flex gap-3 bottom-0 right-0 pr-5">
                    {% for disability in featuresByDisability %}<img src="{{ asset(disability[0].icon) }}" alt="{{ disability[0].disabilityName }}" title="{{ disability[0].disabilityName }}" width="25" height="25" class="dark:invert dark:brightness-0 dark:filter"> {% endfor %}
                </h2>
            </div>
        </article>

        <nav class="grid" aria-label="Game Information Tabs">
            <div class="tab-section bg-stone-100 dark:bg-zinc-700 rounded-lg p-2 border-2 border-indigo-800 dark:border-indigo-200 basis-0 min-w-[70%] max-w-[50rem] backdrop-filter backdrop-blur-lg bg-opacity-40">
                <div class="flex flex-wrap gap-1">
                    <button class="p-2 rounded-lg text-black dark:text-white font-bold flex-grow w-50 hover:bg-gray-300 hover:opacity-40" data-tab-target="#tab1">Accessibility Features</button>
                    <button class="p-2 rounded-lg text-black dark:text-white font-bold flex-grow w-50 hover:bg-gray-300 hover:opacity-40" data-tab-target="#tab2">Media</button>
                    <button class="p-2 rounded-lg text-black dark:text-white font-bold flex-grow w-50 hover:bg-gray-300 hover:opacity-40" data-tab-target="#tab3">Related Content</button>
                    <button class="p-2 rounded-lg text-black dark:text-white font-bold flex-grow w-50 hover:bg-gray-300 hover:opacity-40" data-tab-target="#tab4">Test</button>
                </div>
            </div>
        </nav>

        <div id="tab1" class="w-full tab-content hidden px-5 bg-white dark:bg-neutral-800 mt-5 py-5 rounded-xl shadow-[rgba(50,50,93,0.25)_0px_6px_12px_-2px,_rgba(0,0,0,0.3)_0px_3px_7px_-3px]">
            {# Boucle pour récupérer et trier les features par disability sans doublons #}
            {% for disability, features in featuresByDisability %}
            <article id="disability">
                <header class="flex gap-3 brd-purple">
                    <img src="{{ asset(features[0].icon) }}" alt="{{ features[0].disabilityName }}"
                        title="{{ features[0].disabilityName }}" width="25" height="25" class="dark:invert dark:brightness-0 dark:filter">
                    <h2 class="text-2xl dark:text-white">{{ disability }}</h2>
                </header>

                <hr class="my-3 border-t-2 w-full border-amber-800 dark:border-yellow-200" />

                <ul id="feature-list">
                    {% for feature in features %}
                    <li id="feature" class="mb-5">
                        <h3 class="text-xl pb-2 dark:text-white">{{ feature.featureName }}</h3>
                        <div id="feature-content" class="dark:text-white">
                            {{ feature.content }}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </article>
            {% endfor %}
        </div>

        <div id="tab2" class="w-full tab-content hidden">
            <h2>Test 2</h2>
        </div>

        <div id="tab3" class="w-full tab-content hidden">
            <h2>Test 3</h2>
        </div>

        <div id="tab4" class="w-full tab-content hidden">
            <h2>Test 4</h2>
        </div>
    </section>

    <aside id="secondary" class="basis-0 min-w-[100%] sm:min-w-[30%] sm:basis-3/12 pr-5">
        <div id="forum">
            <a href="{{ path('forum_game', {'id': game.id, 'slug':game.slug}) }}"><h2 class="text-left md:text-right text-2xl dark:text-white font-raleway font-bold pr-3 pt-5">Forum</h2></a>
            <hr class="my-3 w-[100%] border-t-2 border-amber-800 dark:border-yellow-200" />
        </div>


    </aside>
</div>

<script>
    // Je sélectionne tous les éléments qui ont un attribut data-tab-target
    const tabs = document.querySelectorAll('[data-tab-target]');

    // Je sélectionne tous les contenus des onglets
    const tabContents = document.querySelectorAll('.tab-content');

    // Je définis une fonction pour activer un onglet spécifique
    function setActiveTab(tab) {
        // Je commence par retirer les classes actives de tous les onglets
        tabs.forEach(t => {
            t.classList.remove('bg-indigo-800', 'text-white', 'dark:bg-indigo-200', 'dark:text-black');
            t.classList.add('text-black', 'dark:text-white');
        });

        // J'ajoute ensuite les classes actives à l'onglet que je veux activer
        tab.classList.add('bg-indigo-800', 'text-white', 'dark:bg-indigo-200', 'dark:text-black');
        tab.classList.remove('text-black', 'dark:text-white');

        // Je cache tous les contenus des onglets
        tabContents.forEach(content => content.classList.add('hidden'));

        // Je récupère le contenu correspondant à l'onglet actif et je l'affiche
        const target = document.querySelector(tab.dataset.tabTarget);
        target.classList.remove('hidden');
    }

    // J'active le premier onglet par défaut au chargement de la page
    setActiveTab(tabs[0]);

    // J'ajoute un écouteur d'événement sur chaque onglet
    tabs.forEach(tab => {
        tab.addEventListener('click', () => setActiveTab(tab));
    });
</script>

{% endblock %}